fmt           db  "extern	_sprintf%1$cextern	_system%1$cextern	_getenv%1$cextern	_strrchr%1$cextern	_strcmp%1$cextern	_strlen%1$cextern	_fprintf%1$cextern	_fopen%1$cextern	_fclose%1$cSECTION .data%1$cfmt           db  %2$c%3$s%2$c, 10, 0%1$clodash        db  %2$c_%2$c, 0%1$cmode          db  %2$cw+%2$c, 0%1$cprogname      db  %2$cOsully%2$c, 0%1$cfmt_src       db  %2$cSully_%%d.s%2$c, 0%1$cfmt_exe       db  %2$cSully_%%d%2$c, 0%1$cfmt_cmd       db  %2$cnasm -f macho64 %%1$s && ld -macosx_version_min 10.8 -lSystem %%2$.o && ./%%2$s%2$c, 0%1$csrc times 100 db 0%1$cexe times 100 db 0%1$ccmd times 300 db 0%1$cSECTION .bss%1$ci   resq 1%1$cSECTION   .text%1$cglobal    _main%1$c_main:%1$c    enter 16, 0%1$c    mov qword[rel i], %4$d%1$c    cmp qword[rel i], 0%1$c    jle ciao%1$c    call build_strings%1$c    call getpgm%1$c    call ciao%1$cciao:%1$c    mov rax, 0x02000001%1$c    mov rdi, 0%1$c    syscall%1$cbuild_strings:%1$c    enter 0, 0%1$c    lea rdi, [rel src]%1$c    lea rsi, [rel fmt_src]%1$c    mov rdx, [rel i]%1$c    call _sprintf%1$c    lea rdi, [rel exe]%1$c    lea rsi, [rel fmt_exe]%1$c    mov rdx, [rel i]%1$c    call _sprintf%1$c    lea rdi, [rel cmd]%1$c    lea rsi, [rel fmt_cmd]%1$c    lea rdx, [rel src]%1$c    lea rcx, [rel exe]%1$c    call _sprintf%1$c    leave%1$c    ret%1$cgetpgm:%1$c    enter 16, 0%1$c    lea rdi, [rel lodash]%1$c    call _getenv%1$c    mov [rbp+32], rax%1$c    mov rdi, [rbp+32]%1$c    mov rsi, 2Fh%1$c    call _strrchr%1$c    mov [rbp+32], rax%1$c    mov r12, [rbp+32]%1$c    call strtolower%1$c    mov r12, rax%1$c    lea rdi, [rel progname]%1$c    mov rsi, r12%1$c    call _strcmp%1$c    mov r12, rax%1$c    cmp r12, 0%1$c    je next%1$c    dec qword[rel i]%1$cnext:%1$c    call pgm%1$c    leave%1$c    ret%1$cpgm:%1$c    enter 16, 0%1$c    lea rdi, [rel src]%1$c    lea rsi, [rel mode]%1$c    call _fopen%1$c    mov qword[rbp+32], rax%1$c    cmp rax, 0%1$c    je ciao%1$c    mov rdi, [rbp+32]%1$c    lea rsi, [rel fmt]%1$c    mov rdx, 10%1$c    mov rcx, 34%1$c    lea r8, [rel fmt] %1$c    call _fprintf%1$c    mov rdi, [rbp+32]%1$c    call _fclose%1$c    cmp qword[rel i], 0%1$c    jle ciao%1$c    lea rdi, [rel cmd]%1$c    call _system%1$cquit:%1$c    leave%1$c    ret%1$cstrtolower:%1$c    enter 0, 0%1$c    mov rdi, r12%1$c    call _strlen%1$c    mov r13, rax%1$c    mov r15, r12%1$cfor:%1$c    dec r13%1$c    mov rdi, [r12]%1$c    add byte[r12], 32%1$c    cmp r13, 0%1$c    je end%1$c    inc r12%1$c    jmp for%1$cend:%1$c    mov rax, r15%1$c    leave%1$c    ret", 0
